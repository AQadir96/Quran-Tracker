<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Quran Tracker</title>
<link rel="manifest" href="manifest.json"/>
<meta name="theme-color" content="#c9a84c"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<link rel="apple-touch-icon" href="icon-192.png"/>
<link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
:root{--bg:#0a0d12;--sf:#111620;--sf2:#181f2e;--sf3:#1e2840;--bd:#2a3550;--gold:#c9a84c;--gold2:#e8c96a;--grn:#2ecc71;--red:#e74c3c;--blue:#3498db;--tx:#eef2ff;--mt:#7a8aaa;--r:14px;}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;}
body{font-family:Outfit,sans-serif;background:var(--bg);color:var(--tx);display:flex;flex-direction:column;}
body::before{content:"";position:fixed;inset:0;background:radial-gradient(ellipse at 15% 20%,rgba(201,168,76,.08),transparent 55%),radial-gradient(ellipse at 85% 75%,rgba(52,152,219,.05),transparent 55%);pointer-events:none;z-index:0;}
/* HEADER */
.hdr{position:relative;z-index:10;background:rgba(10,13,18,.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--bd);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.logo{display:flex;align-items:center;gap:10px;}
.lm{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:17px;}
.lt{font-size:15px;font-weight:700;}
.ls{font-size:9px;color:var(--mt);letter-spacing:.8px;text-transform:uppercase;}
.hr{display:flex;align-items:center;gap:8px;}
.sd{width:7px;height:7px;border-radius:50%;background:var(--mt);}
.sd.live{background:var(--grn);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.4;}}
/* TABS */
.tabs{position:relative;z-index:9;display:flex;background:var(--sf);border-bottom:1px solid var(--bd);flex-shrink:0;overflow-x:auto;}
.tabs::-webkit-scrollbar{display:none;}
.tab{flex:1;min-width:58px;padding:11px 6px 9px;font-size:10px;font-weight:700;color:var(--mt);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;text-align:center;white-space:nowrap;letter-spacing:.4px;text-transform:uppercase;}
.ti{font-size:15px;display:block;margin-bottom:2px;}
.tab:hover{color:var(--tx);}
.tab.active{color:var(--gold);border-bottom-color:var(--gold);}
/* PAGES */
.pw{flex:1;overflow-y:auto;overflow-x:hidden;position:relative;z-index:1;}
.pw::-webkit-scrollbar{width:3px;}
.pw::-webkit-scrollbar-thumb{background:var(--bd);border-radius:99px;}
.pg{display:none;padding:16px 14px 90px;}
.pg.active{display:block;}
/* CARD */
.card{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:16px;margin-bottom:12px;position:relative;overflow:hidden;}
.ct{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--mt);margin-bottom:12px;}
.card.ac::before{content:"";position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--gold2));}
/* STATS */
.sg{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.sc{background:var(--sf);border:1px solid var(--bd);border-radius:var(--r);padding:14px 12px;position:relative;overflow:hidden;}
.sc::after{content:"";position:absolute;top:0;left:0;right:0;height:2px;}
.g::after{background:linear-gradient(90deg,var(--gold),var(--gold2));}
.gn::after{background:var(--grn);}
.bl::after{background:var(--blue);}
.or::after{background:#e67e22;}
.si{font-size:18px;margin-bottom:5px;}
.sv{font-size:24px;font-weight:800;color:var(--gold2);line-height:1;}
.sl{font-size:11px;color:var(--mt);margin-top:3px;}
/* PROGRESS */
.pw2{margin:6px 0;}
.pr{display:flex;justify-content:space-between;font-size:12px;color:var(--mt);margin-bottom:5px;}
.pb{height:5px;background:var(--sf3);border-radius:99px;overflow:hidden;}
.pf{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold2));transition:width .6s ease;}
.pf.grn{background:var(--grn);}
/* BUTTONS */
.btn{padding:10px 18px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all .15s;font-family:inherit;display:inline-flex;align-items:center;gap:6px;}
.bg1{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#0a0d12;}
.bg1:active{transform:scale(.97);}
.bo{background:transparent;border:1px solid var(--bd);color:var(--tx);}
.bsm{padding:7px 13px;font-size:12px;border-radius:8px;}
.bfw{width:100%;justify-content:center;}
.bdn{background:rgba(231,76,60,.12);border:1px solid rgba(231,76,60,.3);color:var(--red);}
/* FORM */
.fg{margin-bottom:13px;}
label{display:block;font-size:10px;color:var(--mt);margin-bottom:5px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;}
select,input[type=text],input[type=number],input[type=time]{width:100%;background:var(--sf3);border:1px solid var(--bd);border-radius:10px;color:var(--tx);padding:10px 12px;font-size:14px;font-family:inherit;outline:none;transition:border-color .2s;appearance:none;-webkit-appearance:none;}
select:focus,input:focus{border-color:var(--gold);}
select option{background:var(--sf3);}
/* MODAL */
.mo{display:none;position:fixed;inset:0;z-index:100;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);align-items:flex-end;justify-content:center;}
.mo.open{display:flex;}
.md{background:var(--sf);border:1px solid var(--bd);border-radius:20px 20px 0 0;padding:20px 18px 40px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;animation:su .25s ease;}
.md::-webkit-scrollbar{display:none;}
@keyframes su{from{transform:translateY(40px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.mh{width:36px;height:4px;background:var(--bd);border-radius:99px;margin:0 auto 18px;}
.mtl{font-size:17px;font-weight:700;margin-bottom:16px;}
/* USER PILL */
.up{display:flex;align-items:center;gap:7px;background:var(--sf2);border:1px solid var(--bd);border-radius:99px;padding:5px 12px 5px 5px;cursor:pointer;font-size:12px;font-weight:600;transition:border-color .2s;}
.up:hover{border-color:var(--gold);}
.av{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;flex-shrink:0;}
/* TYPE TOGGLE */
.tt{display:flex;background:var(--sf3);border-radius:10px;padding:3px;margin-bottom:14px;}
.tb{flex:1;padding:8px;border-radius:7px;font-size:13px;font-weight:600;text-align:center;cursor:pointer;transition:all .2s;color:var(--mt);}
.tb.active{background:var(--sf);color:var(--gold);box-shadow:0 2px 8px rgba(0,0,0,.3);}
/* LEADERBOARD */
.lr{display:flex;align-items:center;gap:10px;padding:11px 0;border-bottom:1px solid var(--bd);}
.lr:last-child{border-bottom:none;}
.lrk{font-size:15px;width:26px;text-align:center;font-weight:800;flex-shrink:0;}
.li{flex:1;min-width:0;}
.ln{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.lv{font-size:17px;font-weight:800;color:var(--gold2);flex-shrink:0;}
.lb2{height:3px;background:var(--sf3);border-radius:99px;margin-top:3px;overflow:hidden;}
.lf{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--gold),var(--gold2));}
/* SEGMENTS */
.si2{display:flex;align-items:center;gap:10px;padding:11px 12px;background:var(--sf3);border-radius:10px;margin-bottom:7px;cursor:pointer;border:1px solid transparent;transition:all .2s;user-select:none;}
.si2.al{opacity:.55;cursor:default;}
.si2.sl2{background:rgba(201,168,76,.12);border-color:rgba(201,168,76,.4);}
.ck{width:20px;height:20px;border-radius:6px;border:2px solid var(--bd);flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:11px;}
.si2.sl2 .ck{background:var(--gold);border-color:var(--gold);color:#000;}
.si2.al .ck{background:rgba(46,204,113,.2);border-color:var(--grn);color:var(--grn);}
.sklb{font-size:13px;font-weight:600;}
.skar{font-family:"Scheherazade New",serif;font-size:14px;color:var(--mt);direction:rtl;}
.sdt{margin-left:auto;font-size:10px;font-weight:700;padding:2px 8px;border-radius:99px;background:rgba(46,204,113,.12);color:var(--grn);flex-shrink:0;}
/* JUZ GRID */
.jg{display:grid;grid-template-columns:repeat(6,1fr);gap:5px;}
.jc{background:var(--sf3);border:1px solid var(--bd);border-radius:7px;padding:7px 3px;text-align:center;transition:all .2s;}
.jc.dn{background:rgba(201,168,76,.2);border-color:rgba(201,168,76,.5);}
.jc.pt{background:rgba(201,168,76,.07);border-color:rgba(201,168,76,.2);}
.jn{font-size:14px;font-weight:800;}
.jp{font-size:9px;color:var(--mt);margin-top:1px;}
.jc.dn .jp{color:var(--gold);}
/* LOG ITEMS */
.lgi{display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid var(--bd);}
.lgi:last-child{border-bottom:none;}
.lgxt{font-size:13px;line-height:1.5;}
.lgm{font-size:11px;color:var(--mt);margin-top:2px;}
/* BADGES */
.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:99px;font-size:10px;font-weight:700;}
.bdg{background:rgba(201,168,76,.15);color:var(--gold2);border:1px solid rgba(201,168,76,.3);}
.bdb{background:rgba(52,152,219,.1);color:var(--blue);border:1px solid rgba(52,152,219,.3);}
.bdgn{background:rgba(46,204,113,.1);color:var(--grn);border:1px solid rgba(46,204,113,.3);}
/* NOTIFY */
.ntf{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:999;background:var(--sf);border:1px solid var(--grn);color:var(--grn);padding:9px 18px;border-radius:99px;font-size:13px;font-weight:600;display:none;white-space:nowrap;box-shadow:0 8px 40px rgba(0,0,0,.5);}
.ntf.err{border-color:var(--red);color:var(--red);}
/* LOADING */
.ldg{position:fixed;inset:0;z-index:200;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;}
.ldgi{font-size:52px;animation:sp 3s linear infinite;}
@keyframes sp{to{transform:rotate(360deg);}}
.ldgt{font-size:13px;color:var(--mt);}
/* MISC */
.ofb{background:var(--red);color:#fff;text-align:center;font-size:12px;font-weight:600;padding:5px;display:none;flex-shrink:0;z-index:8;position:relative;}
.hb{background:rgba(201,168,76,.08);border:1px solid rgba(201,168,76,.25);border-radius:9px;padding:10px 12px;font-size:12px;margin-bottom:12px;}
.sw-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;}
.sw{position:relative;width:44px;height:24px;flex-shrink:0;}
.sw input{opacity:0;width:0;height:0;}
.sldr{position:absolute;inset:0;background:var(--sf3);border-radius:99px;cursor:pointer;transition:.3s;border:1px solid var(--bd);}
.sldr:before{content:"";position:absolute;width:18px;height:18px;border-radius:50%;background:var(--mt);bottom:2px;left:2px;transition:.3s;}
input:checked+.sldr{background:rgba(201,168,76,.25);border-color:var(--gold);}
input:checked+.sldr:before{transform:translateX(20px);background:var(--gold);}
.empty{text-align:center;padding:32px 16px;color:var(--mt);}
.ei{font-size:36px;margin-bottom:10px;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.rb{background:linear-gradient(135deg,rgba(201,168,76,.12),rgba(201,168,76,.04));border:1px solid rgba(201,168,76,.25);border-radius:var(--r);padding:13px;margin-bottom:12px;display:flex;align-items:center;gap:10px;}
@media(min-width:480px){.jg{grid-template-columns:repeat(8,1fr);}.md{border-radius:20px;margin:16px;width:calc(100% - 32px);max-width:460px;align-self:center;}.mo{align-items:center;}}
</style>
</head>
<body>
<div class="ldg" id="ldg"><div class="ldgi">ğŸ•Œ</div><div class="ldgt">Connecting to Quran Trackerâ€¦</div></div>
<div class="ofb" id="ofb">ğŸ“µ Offline â€” changes will sync when connected</div>
<div class="ntf" id="ntf"></div>

<div class="mo" id="userModal">
  <div class="md">
    <div class="mh"></div>
    <div class="mtl">ğŸ‘¤ Who are you?</div>
    <div id="ulEl" style="margin-bottom:14px;"></div>
    <div style="display:flex;gap:8px;">
      <input type="text" id="nuInp" placeholder="Add new nameâ€¦" style="flex:1;"/>
      <button class="btn bg1 bsm" onclick="addUser()">Add</button>
    </div>
  </div>
</div>

<div class="mo" id="logModal">
  <div class="md">
    <div class="mh"></div>
    <div class="mtl">ğŸ“– Log Reading</div>
    <div class="tt" id="mTT">
      <div class="tb active" onclick="setMT('primary',this)">â­ Primary</div>
      <div class="tb" onclick="setMT('secondary',this)">ğŸ“š Secondary</div>
    </div>
    <div id="mTH" style="font-size:12px;color:var(--mt);margin-bottom:12px;">Primary counts toward competition &amp; completion %</div>
    <div class="fg"><label>Log by</label><select id="mLB" onchange="uMF()"><option value="juz">Juz (Para)</option><option value="surah">Surah</option></select></div>
    <div id="mJF"><div class="fg"><label>Select Juz</label><select id="mJS"></select></div><div id="mSC"></div></div>
    <div id="mSF" style="display:none;">
      <div class="fg"><label>Select Surah</label><select id="mSS"></select></div>
      <div id="mSH"></div>
      <div class="g2"><div class="fg"><label>From Ayah</label><input type="number" id="mFr" min="1"/></div><div class="fg"><label>To Ayah</label><input type="number" id="mTo" min="1"/></div></div>
      <div id="mSP" class="pw2"></div>
    </div>
    <div class="fg"><label>Note (optional)</label><input type="text" id="mNt" placeholder="e.g. After Fajrâ€¦"/></div>
    <div style="display:flex;gap:8px;margin-top:6px;">
      <button class="btn bg1 bfw" onclick="subML()">âœ“ Save</button>
      <button class="btn bo" onclick="cModal('logModal')" style="flex-shrink:0;">âœ•</button>
    </div>
  </div>
</div>

<div class="hdr">
  <div class="logo"><div class="lm">ğŸ•Œ</div><div><div class="lt">Quran Tracker</div><div class="ls">Live Sync</div></div></div>
  <div class="hr">
    <div class="sd" id="sdot"></div>
    <button class="btn bg1 bsm" onclick="oModal('logModal')">+ Log</button>
    <div class="up" onclick="oModal('userModal')"><div class="av" id="hAv" style="background:#444;">?</div><span id="hNm">Select</span></div>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="sTab('dashboard')"><span class="ti">ğŸ“Š</span>Home</div>
  <div class="tab" onclick="sTab('log')"><span class="ti">ğŸ“–</span>Log</div>
  <div class="tab" onclick="sTab('progress')"><span class="ti">ğŸ—º</span>Progress</div>
  <div class="tab" onclick="sTab('leaderboard')"><span class="ti">ğŸ†</span>Compete</div>
  <div class="tab" onclick="sTab('settings')"><span class="ti">âš™ï¸</span>Settings</div>
</div>

<div class="pw">
  <div class="pg active" id="pg-dashboard">
    <div id="bnr"></div>
    <div class="sg">
      <div class="sc g"><div class="si">ğŸ“–</div><div class="sv" id="dA">â€”</div><div class="sl">My Ayahs (Primary)</div></div>
      <div class="sc gn"><div class="si">âœ…</div><div class="sv" id="dP">â€”</div><div class="sl">Quran Complete</div></div>
      <div class="sc bl"><div class="si">ğŸ“…</div><div class="sv" id="dT">â€”</div><div class="sl">Today's Ayahs</div></div>
      <div class="sc or"><div class="si">ğŸ”¥</div><div class="sv" id="dS">â€”</div><div class="sl">Day Streak</div></div>
    </div>
    <div class="card ac"><div class="ct">Primary Quran Completion</div>
      <div class="pw2"><div class="pr"><span id="dPL">0 / 6236 ayahs</span><span id="dPP">0%</span></div><div class="pb"><div class="pf" id="dPF" style="width:0%"></div></div></div>
    </div>
    <div class="card"><div class="ct">Today's Leaders</div><div id="dTp"></div></div>
    <div class="card"><div class="ct">Recent Activity</div><div id="dRc"></div></div>
  </div>

  <div class="pg" id="pg-log">
    <div class="card ac">
      <div class="ct">Quick Log</div>
      <div class="tt" id="qTT"><div class="tb active" onclick="setQT('primary',this)">â­ Primary</div><div class="tb" onclick="setQT('secondary',this)">ğŸ“š Secondary</div></div>
      <div class="fg"><label>Log by</label><select id="qLB" onchange="uQF()"><option value="juz">Juz (Para)</option><option value="surah">Surah</option></select></div>
      <div id="qJF"><div class="fg"><label>Select Juz</label><select id="qJS"></select></div><div id="qSC"></div></div>
      <div id="qSF" style="display:none;">
        <div class="fg"><label>Select Surah</label><select id="qSS"></select></div>
        <div id="qSH"></div>
        <div class="g2"><div class="fg"><label>From Ayah</label><input type="number" id="qFr" min="1"/></div><div class="fg"><label>To Ayah</label><input type="number" id="qTo" min="1"/></div></div>
        <div id="qSP" class="pw2"></div>
      </div>
      <div class="fg"><label>Note</label><input type="text" id="qNt" placeholder="e.g. After Fajrâ€¦"/></div>
      <button class="btn bg1 bfw" onclick="subQL()">âœ“ Save Reading</button>
    </div>
    <div class="card"><div class="ct">My Recent Logs</div><div id="qRc"></div></div>
  </div>

  <div class="pg" id="pg-progress">
    <div class="card ac"><div class="ct">Juz Map â€” Primary</div><div class="jg" id="jGrid"></div></div>
    <div class="card"><div class="ct">Surah Progress â€” Primary</div><div id="sProg"></div></div>
    <div class="card"><div class="ct">ğŸ“š Secondary Logs</div><div id="secL"></div></div>
  </div>

  <div class="pg" id="pg-leaderboard">
    <div class="card ac"><div class="ct">ğŸ† All-Time Ayahs (Primary)</div><div id="lbA"></div></div>
    <div class="card"><div class="ct">ğŸ“… This Week</div><div id="lbW"></div></div>
    <div class="card"><div class="ct">ğŸŒ… Today</div><div id="lbT"></div></div>
    <div class="card"><div class="ct">ğŸ“– Quran Completion %</div><div id="lbC"></div></div>
  </div>

  <div class="pg" id="pg-settings">
    <div class="card ac">
      <div class="ct">ğŸŒ… Fajr Reminder</div>
      <div class="sw-row">
        <div><div style="font-size:14px;font-weight:600;">Daily Fajr Reminder</div><div style="font-size:12px;color:var(--mt);">Reminds you to log your reading</div></div>
        <label class="sw"><input type="checkbox" id="remTgl" onchange="tglRem()"/><span class="sldr"></span></label>
      </div>
      <div id="remTW" style="display:none;margin-top:8px;">
        <div class="fg"><label>Reminder Time</label><input type="time" id="remTm" value="05:30" onchange="savRT()"/></div>
        <div style="font-size:12px;color:var(--mt);">Notification fires at this time if you have not logged yet today.</div>
      </div>
    </div>
    <div class="card"><div class="ct">Account</div>
      <div class="sw-row">
        <div><div style="font-size:14px;font-weight:600;" id="sUN">Not selected</div><div style="font-size:12px;color:var(--mt);">Current user</div></div>
        <button class="btn bo bsm" onclick="oModal('userModal')">Switch</button>
      </div>
    </div>
    <div class="card"><div class="ct">Data &amp; Sync</div>
      <div style="font-size:13px;color:var(--mt);margin-bottom:12px;line-height:1.7;">All readings sync live to Firebase. Everyone's leaderboard updates in real time.</div>
      <button class="btn bdn bsm" onclick="cfDel()">ğŸ—‘ Delete My Logs</button>
    </div>
    <div class="card"><div class="ct">About</div>
      <div style="font-size:13px;color:var(--mt);line-height:1.9;">Version 2.0 Â· Firebase Sync<br/>114 Surahs Â· 30 Juz Â· 6,236 Ayahs<br/>â­ Primary: competes on leaderboard<br/>ğŸ“š Secondary: personal extra reading</div>
    </div>
  </div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import{getFirestore,collection,addDoc,onSnapshot,query,orderBy,deleteDoc,where,getDocs,doc}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
const cfg={apiKey:"AIzaSyDIa2Klm7lRI7xDlion2YNeYr5n2PB4byc",authDomain:"quran-tracker-2026.firebaseapp.com",projectId:"quran-tracker-2026",storageBucket:"quran-tracker-2026.firebasestorage.app",messagingSenderId:"978262243606",appId:"1:978262243606:web:144665037dc77dc291b837"};
const app=initializeApp(cfg);const db=getFirestore(app);
window._db=db;window._col=collection;window._add=addDoc;window._sn=onSnapshot;window._q=query;window._ord=orderBy;window._del=deleteDoc;window._wh=where;window._gd=getDocs;window._dc=doc;
window._fbReady=true;
</script>

<script>
const SH=[{n:1,name:"Al-Fatiha",ar:"Ø§Ù„ÙØ§ØªØ­Ø©",a:7},{n:2,name:"Al-Baqarah",ar:"Ø§Ù„Ø¨Ù‚Ø±Ø©",a:286},{n:3,name:"Al-Imran",ar:"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†",a:200},{n:4,name:"An-Nisa",ar:"Ø§Ù„Ù†Ø³Ø§Ø¡",a:176},{n:5,name:"Al-Maidah",ar:"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©",a:120},{n:6,name:"Al-Anam",ar:"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…",a:165},{n:7,name:"Al-Araf",ar:"Ø§Ù„Ø£Ø¹Ø±Ø§Ù",a:206},{n:8,name:"Al-Anfal",ar:"Ø§Ù„Ø£Ù†ÙØ§Ù„",a:75},{n:9,name:"At-Tawbah",ar:"Ø§Ù„ØªÙˆØ¨Ø©",a:129},{n:10,name:"Yunus",ar:"ÙŠÙˆÙ†Ø³",a:109},{n:11,name:"Hud",ar:"Ù‡ÙˆØ¯",a:123},{n:12,name:"Yusuf",ar:"ÙŠÙˆØ³Ù",a:111},{n:13,name:"Ar-Rad",ar:"Ø§Ù„Ø±Ø¹Ø¯",a:43},{n:14,name:"Ibrahim",ar:"Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…",a:52},{n:15,name:"Al-Hijr",ar:"Ø§Ù„Ø­Ø¬Ø±",a:99},{n:16,name:"An-Nahl",ar:"Ø§Ù„Ù†Ø­Ù„",a:128},{n:17,name:"Al-Isra",ar:"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡",a:111},{n:18,name:"Al-Kahf",ar:"Ø§Ù„ÙƒÙ‡Ù",a:110},{n:19,name:"Maryam",ar:"Ù…Ø±ÙŠÙ…",a:98},{n:20,name:"Ta-Ha",ar:"Ø·Ù‡",a:135},{n:21,name:"Al-Anbiya",ar:"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡",a:112},{n:22,name:"Al-Hajj",ar:"Ø§Ù„Ø­Ø¬",a:78},{n:23,name:"Al-Muminun",ar:"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†",a:118},{n:24,name:"An-Nur",ar:"Ø§Ù„Ù†ÙˆØ±",a:64},{n:25,name:"Al-Furqan",ar:"Ø§Ù„ÙØ±Ù‚Ø§Ù†",a:77},{n:26,name:"Ash-Shuara",ar:"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡",a:227},{n:27,name:"An-Naml",ar:"Ø§Ù„Ù†Ù…Ù„",a:93},{n:28,name:"Al-Qasas",ar:"Ø§Ù„Ù‚ØµØµ",a:88},{n:29,name:"Al-Ankabut",ar:"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª",a:69},{n:30,name:"Ar-Rum",ar:"Ø§Ù„Ø±ÙˆÙ…",a:60},{n:31,name:"Luqman",ar:"Ù„Ù‚Ù…Ø§Ù†",a:34},{n:32,name:"As-Sajdah",ar:"Ø§Ù„Ø³Ø¬Ø¯Ø©",a:30},{n:33,name:"Al-Ahzab",ar:"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨",a:73},{n:34,name:"Saba",ar:"Ø³Ø¨Ø£",a:54},{n:35,name:"Fatir",ar:"ÙØ§Ø·Ø±",a:45},{n:36,name:"Ya-Sin",ar:"ÙŠØ³",a:83},{n:37,name:"As-Saffat",ar:"Ø§Ù„ØµØ§ÙØ§Øª",a:182},{n:38,name:"Sad",ar:"Øµ",a:88},{n:39,name:"Az-Zumar",ar:"Ø§Ù„Ø²Ù…Ø±",a:75},{n:40,name:"Ghafir",ar:"ØºØ§ÙØ±",a:85},{n:41,name:"Fussilat",ar:"ÙØµÙ„Øª",a:54},{n:42,name:"Ash-Shura",ar:"Ø§Ù„Ø´ÙˆØ±Ù‰",a:53},{n:43,name:"Az-Zukhruf",ar:"Ø§Ù„Ø²Ø®Ø±Ù",a:89},{n:44,name:"Ad-Dukhan",ar:"Ø§Ù„Ø¯Ø®Ø§Ù†",a:59},{n:45,name:"Al-Jathiyah",ar:"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©",a:37},{n:46,name:"Al-Ahqaf",ar:"Ø§Ù„Ø£Ø­Ù‚Ø§Ù",a:35},{n:47,name:"Muhammad",ar:"Ù…Ø­Ù…Ø¯",a:38},{n:48,name:"Al-Fath",ar:"Ø§Ù„ÙØªØ­",a:29},{n:49,name:"Al-Hujurat",ar:"Ø§Ù„Ø­Ø¬Ø±Ø§Øª",a:18},{n:50,name:"Qaf",ar:"Ù‚",a:45},{n:51,name:"Adh-Dhariyat",ar:"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª",a:60},{n:52,name:"At-Tur",ar:"Ø§Ù„Ø·ÙˆØ±",a:49},{n:53,name:"An-Najm",ar:"Ø§Ù„Ù†Ø¬Ù…",a:62},{n:54,name:"Al-Qamar",ar:"Ø§Ù„Ù‚Ù…Ø±",a:55},{n:55,name:"Ar-Rahman",ar:"Ø§Ù„Ø±Ø­Ù…Ù†",a:78},{n:56,name:"Al-Waqiah",ar:"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©",a:96},{n:57,name:"Al-Hadid",ar:"Ø§Ù„Ø­Ø¯ÙŠØ¯",a:29},{n:58,name:"Al-Mujadila",ar:"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©",a:22},{n:59,name:"Al-Hashr",ar:"Ø§Ù„Ø­Ø´Ø±",a:24},{n:60,name:"Al-Mumtahanah",ar:"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©",a:13},{n:61,name:"As-Saf",ar:"Ø§Ù„ØµÙ",a:14},{n:62,name:"Al-Jumuah",ar:"Ø§Ù„Ø¬Ù…Ø¹Ø©",a:11},{n:63,name:"Al-Munafiqun",ar:"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†",a:11},{n:64,name:"At-Taghabun",ar:"Ø§Ù„ØªØºØ§Ø¨Ù†",a:18},{n:65,name:"At-Talaq",ar:"Ø§Ù„Ø·Ù„Ø§Ù‚",a:12},{n:66,name:"At-Tahrim",ar:"Ø§Ù„ØªØ­Ø±ÙŠÙ…",a:12},{n:67,name:"Al-Mulk",ar:"Ø§Ù„Ù…Ù„Ùƒ",a:30},{n:68,name:"Al-Qalam",ar:"Ø§Ù„Ù‚Ù„Ù…",a:52},{n:69,name:"Al-Haqqah",ar:"Ø§Ù„Ø­Ø§Ù‚Ø©",a:52},{n:70,name:"Al-Maarij",ar:"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬",a:44},{n:71,name:"Nuh",ar:"Ù†ÙˆØ­",a:28},{n:72,name:"Al-Jinn",ar:"Ø§Ù„Ø¬Ù†",a:28},{n:73,name:"Al-Muzzammil",ar:"Ø§Ù„Ù…Ø²Ù…Ù„",a:20},{n:74,name:"Al-Muddaththir",ar:"Ø§Ù„Ù…Ø¯Ø«Ø±",a:56},{n:75,name:"Al-Qiyamah",ar:"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©",a:40},{n:76,name:"Al-Insan",ar:"Ø§Ù„Ø¥Ù†Ø³Ø§Ù†",a:31},{n:77,name:"Al-Mursalat",ar:"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª",a:50},{n:78,name:"An-Naba",ar:"Ø§Ù„Ù†Ø¨Ø£",a:40},{n:79,name:"An-Naziat",ar:"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª",a:46},{n:80,name:"Abasa",ar:"Ø¹Ø¨Ø³",a:42},{n:81,name:"At-Takwir",ar:"Ø§Ù„ØªÙƒÙˆÙŠØ±",a:29},{n:82,name:"Al-Infitar",ar:"Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±",a:19},{n:83,name:"Al-Mutaffifin",ar:"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†",a:36},{n:84,name:"Al-Inshiqaq",ar:"Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚",a:25},{n:85,name:"Al-Buruj",ar:"Ø§Ù„Ø¨Ø±ÙˆØ¬",a:22},{n:86,name:"At-Tariq",ar:"Ø§Ù„Ø·Ø§Ø±Ù‚",a:17},{n:87,name:"Al-Ala",ar:"Ø§Ù„Ø£Ø¹Ù„Ù‰",a:19},{n:88,name:"Al-Ghashiyah",ar:"Ø§Ù„ØºØ§Ø´ÙŠØ©",a:26},{n:89,name:"Al-Fajr",ar:"Ø§Ù„ÙØ¬Ø±",a:30},{n:90,name:"Al-Balad",ar:"Ø§Ù„Ø¨Ù„Ø¯",a:20},{n:91,name:"Ash-Shams",ar:"Ø§Ù„Ø´Ù…Ø³",a:15},{n:92,name:"Al-Layl",ar:"Ø§Ù„Ù„ÙŠÙ„",a:21},{n:93,name:"Ad-Duha",ar:"Ø§Ù„Ø¶Ø­Ù‰",a:11},{n:94,name:"Ash-Sharh",ar:"Ø§Ù„Ø´Ø±Ø­",a:8},{n:95,name:"At-Tin",ar:"Ø§Ù„ØªÙŠÙ†",a:8},{n:96,name:"Al-Alaq",ar:"Ø§Ù„Ø¹Ù„Ù‚",a:19},{n:97,name:"Al-Qadr",ar:"Ø§Ù„Ù‚Ø¯Ø±",a:5},{n:98,name:"Al-Bayyinah",ar:"Ø§Ù„Ø¨ÙŠÙ†Ø©",a:8},{n:99,name:"Az-Zalzalah",ar:"Ø§Ù„Ø²Ù„Ø²Ù„Ø©",a:8},{n:100,name:"Al-Adiyat",ar:"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª",a:11},{n:101,name:"Al-Qariah",ar:"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©",a:11},{n:102,name:"At-Takathur",ar:"Ø§Ù„ØªÙƒØ§Ø«Ø±",a:8},{n:103,name:"Al-Asr",ar:"Ø§Ù„Ø¹ØµØ±",a:3},{n:104,name:"Al-Humazah",ar:"Ø§Ù„Ù‡Ù…Ø²Ø©",a:9},{n:105,name:"Al-Fil",ar:"Ø§Ù„ÙÙŠÙ„",a:5},{n:106,name:"Quraysh",ar:"Ù‚Ø±ÙŠØ´",a:4},{n:107,name:"Al-Maun",ar:"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†",a:7},{n:108,name:"Al-Kawthar",ar:"Ø§Ù„ÙƒÙˆØ«Ø±",a:3},{n:109,name:"Al-Kafirun",ar:"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†",a:6},{n:110,name:"An-Nasr",ar:"Ø§Ù„Ù†ØµØ±",a:3},{n:111,name:"Al-Masad",ar:"Ø§Ù„Ù…Ø³Ø¯",a:5},{n:112,name:"Al-Ikhlas",ar:"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ",a:4},{n:113,name:"Al-Falaq",ar:"Ø§Ù„ÙÙ„Ù‚",a:5},{n:114,name:"An-Nas",ar:"Ø§Ù„Ù†Ø§Ø³",a:6}];
const JS=Array.from({length:30},(_,i)=>{const n=i+1;return{n,s:[{id:`${n}_1`,lb:"1st Quarter",ar:"Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„"},{id:`${n}_2`,lb:"2nd Quarter",ar:"Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ"},{id:`${n}_3`,lb:"3rd Quarter",ar:"Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«"},{id:`${n}_4`,lb:"4th Quarter",ar:"Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø¹"}]};});
const TOT=6236;
const CL=["#c9a84c","#2ecc71","#3498db","#e74c3c","#9b59b6","#1abc9c","#e67e22","#e91e63"];
const aC=n=>CL[(n||"?").charCodeAt(0)%CL.length];
const ini=n=>(n||"?").slice(0,2).toUpperCase();
const td=()=>new Date().toISOString().split("T")[0];
const wAgo=()=>{const d=new Date();d.setDate(d.getDate()-7);return d.toISOString().split("T")[0];};
const ST={u:localStorage.getItem("qt_u")||null,us:JSON.parse(localStorage.getItem("qt_us")||"[]"),lg:[],mt:"primary",qt:"primary"};

function startFbListener(){
  const q=window._q(window._col(window._db,"logs"),window._ord("ts","desc"));
  window._sn(q,sn=>{
    ST.lg=sn.docs.map(d=>({id:d.id,...d.data()}));
    document.getElementById("ldg").style.display="none";
    document.getElementById("sdot").className="sd live";
    rAll();
  },err=>{
    console.error("Firestore error:",err);
    document.getElementById("ldg").style.display="none";
    document.getElementById("ldg").innerHTML='<div style="color:#e74c3c;font-size:14px;padding:20px;text-align:center;">âš ï¸ Firebase connection failed.<br/>Check console for details.</div>';
    ntf("Sync error: "+err.code,true);
  });
}
// Poll until Firebase module is ready
(function waitFb(){
  if(window._fbReady){startFbListener();}
  else{setTimeout(waitFb,100);}
})();

async function fbAdd(l){await window._add(window._col(window._db,"logs"),{...l,ts:Date.now()});}
async function fbDel(user){const q=window._q(window._col(window._db,"logs"),window._wh("user","==",user));const sn=await window._gd(q);await Promise.all(sn.docs.map(d=>window._del(window._dc(window._db,"logs",d.id))));}

const mxA=(u,sN,t="primary")=>{const ls=ST.lg.filter(l=>l.user===u&&l.type==="surah"&&l.surahN===sN&&(l.rt||"primary")===t);return ls.length?Math.max(...ls.map(l=>l.toAyah)):0;};
const rSeg=(u,t="primary")=>{const s=new Set();ST.lg.filter(l=>l.user===u&&l.type==="juz"&&(l.rt||"primary")===t).forEach(l=>(l.sg||[]).forEach(x=>s.add(x)));return s;};
const uniqA=u=>{let t=0;SH.forEach(s=>{t+=mxA(u,s.n,"primary");});t+=rSeg(u,"primary").size*50;return Math.min(t,TOT);};
const stk=u=>{const days=new Set(ST.lg.filter(l=>l.user===u&&(l.rt||"primary")==="primary").map(l=>l.date));let s=0;const d=new Date();for(;;){const ds=d.toISOString().split("T")[0];if(days.has(ds)){s++;d.setDate(d.getDate()-1);}else break;}return s;};

function rUM(){
  const fl=[...new Set(ST.lg.map(l=>l.user))];
  ST.us=[...new Set([...ST.us,...fl])];
  localStorage.setItem("qt_us",JSON.stringify(ST.us));
  const el=document.getElementById("ulEl");
  el.innerHTML=ST.us.length?ST.us.map(u=>`<div class="lr" style="cursor:pointer;" onclick="selU('${u}')"><div class="av" style="background:${aC(u)};color:#000;width:34px;height:34px;font-size:12px;">${ini(u)}</div><div class="li"><div class="ln">${u}</div><div style="font-size:11px;color:var(--mt);">${ST.lg.filter(l=>l.user===u).length} logs</div></div>${ST.u===u?'<span class="badge bdg">Active</span>':""}</div>`).join(""):'<div style="color:var(--mt);font-size:13px;margin-bottom:10px;">Add yourself below!</div>';
}
function addUser(){const i=document.getElementById("nuInp");const n=i.value.trim();if(!n)return;if(ST.us.includes(n)){ntf("Name exists",true);return;}ST.us.push(n);localStorage.setItem("qt_us",JSON.stringify(ST.us));selU(n);i.value="";}
function selU(n){ST.u=n;localStorage.setItem("qt_u",n);cModal("userModal");uHdr();rAll();ntf(`Welcome ${n}! ğŸŒ™`);}
function uHdr(){const u=ST.u;const av=document.getElementById("hAv");const nm=document.getElementById("hNm");if(u){av.style.background=aC(u);av.style.color="#000";av.textContent=ini(u);nm.textContent=u;document.getElementById("sUN").textContent=u;}else{av.textContent="?";av.style.background="#444";nm.textContent="Select";}}

function popSels(){
  const jO=JS.map(j=>`<option value="${j.n}">Juz ${j.n}</option>`).join("");
  const sO=SH.map(s=>`<option value="${s.n}">${s.n}. ${s.name} (${s.ar}) â€” ${s.a} ayahs</option>`).join("");
  ["mJS","qJS"].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=jO;});
  ["mSS","qSS"].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=sO;});
}

function rSgs(jN,cid,t){
  const juz=JS[jN-1];const dn=rSeg(ST.u,t||"primary");
  const el=document.getElementById(cid);if(!el)return;
  el.innerHTML=juz.s.map(s=>{const d=dn.has(s.id);return`<div class="si2${d?" al":""}" id="sw_${s.id}_${cid}" ${d?"":"onclick="tSg('"+s.id+"','"+cid+"')""}>
    <div class="ck" id="sc_${s.id}_${cid}">${d?"âœ“":""}</div>
    <div style="flex:1;"><div class="sklb">${s.lb}</div><div class="skar">${s.ar}</div></div>
    ${d?'<span class="sdt">âœ“ Read</span>':""}</div>`;}).join("");
}
function tSg(id,cid){const w=document.getElementById(`sw_${id}_${cid}`);const c=document.getElementById(`sc_${id}_${cid}`);if(!w||w.classList.contains("al"))return;const on=w.classList.toggle("sl2");c.textContent=on?"âœ“":"";}
function gCSg(cid,jN){return JS[jN-1].s.filter(s=>{const w=document.getElementById(`sw_${s.id}_${cid}`);return w&&w.classList.contains("sl2");}).map(s=>s.id);}

function sHint(u,sN,t){const s=SH[sN-1];const mx=mxA(u,sN,t);const nx=Math.min(mx+1,s.a);return mx>0?`<div class="hb">ğŸ“Œ Last read: Ayah <strong>${mx}</strong> â€” continuing from <strong>${nx}</strong></div>`:`<div style="font-size:12px;color:var(--mt);margin-bottom:10px;">Starting from Ayah 1</div>`;}
function sPrg(u,sN,t){const s=SH[sN-1];const mx=mxA(u,sN,t);const p=Math.round(mx/s.a*100);return`<div class="pr"><span>${s.name}</span><span>${mx}/${s.a} (${p}%)</span></div><div class="pb"><div class="pf" style="width:${p}%"></div></div>`;}
function sFT(fId,tId,u,sN,t){const s=SH[sN-1];const mx=mxA(u,sN,t);const nx=Math.min(mx+1,s.a);document.getElementById(fId).value=nx;document.getElementById(fId).max=s.a;document.getElementById(tId).value=s.a;document.getElementById(tId).max=s.a;}

function uMS(){const n=parseInt(document.getElementById("mSS").value);document.getElementById("mSH").innerHTML=sHint(ST.u,n,ST.mt);sFT("mFr","mTo",ST.u,n,ST.mt);document.getElementById("mSP").innerHTML=sPrg(ST.u,n,ST.mt);}
function uQS(){const n=parseInt(document.getElementById("qSS").value);document.getElementById("qSH").innerHTML=sHint(ST.u,n,ST.qt);sFT("qFr","qTo",ST.u,n,ST.qt);document.getElementById("qSP").innerHTML=sPrg(ST.u,n,ST.qt);}

function uMF(){const v=document.getElementById("mLB").value;document.getElementById("mJF").style.display=v==="juz"?"":"none";document.getElementById("mSF").style.display=v==="surah"?"":"none";if(v==="juz")rSgs(parseInt(document.getElementById("mJS").value),"mSC",ST.mt);if(v==="surah")uMS();}
function uQF(){const v=document.getElementById("qLB").value;document.getElementById("qJF").style.display=v==="juz"?"":"none";document.getElementById("qSF").style.display=v==="surah"?"":"none";if(v==="juz")rQSg();if(v==="surah")uQS();}
function rMSg(){rSgs(parseInt(document.getElementById("mJS").value),"mSC",ST.mt);}
function rQSg(){rSgs(parseInt(document.getElementById("qJS").value),"qSC",ST.qt);}

function setMT(t,el){ST.mt=t;document.querySelectorAll("#mTT .tb").forEach(b=>b.classList.remove("active"));el.classList.add("active");document.getElementById("mTH").textContent=t==="primary"?"Primary counts toward competition & completion %":"Secondary: personal extra reading â€” not in competition";uMF();}
function setQT(t,el){ST.qt=t;document.querySelectorAll("#qTT .tb").forEach(b=>b.classList.remove("active"));el.classList.add("active");uQF();}

async function bLog(byId,jId,sCid,sId,fId,tId,nId,rt){
  if(!ST.u){ntf("Select a user first!",true);oModal("userModal");return null;}
  const by=document.getElementById(byId).value;
  const note=document.getElementById(nId).value.trim();
  let l={user:ST.u,type:by,rt,date:td(),note};
  if(by==="juz"){
    const jN=parseInt(document.getElementById(jId).value);
    const sg=gCSg(sCid,jN);if(!sg.length){ntf("Select at least one quarter!",true);return null;}
    const al=rSeg(ST.u,rt);const nsg=sg.filter(s=>!al.has(s));
    if(!nsg.length){ntf("Already logged these!",true);return null;}
    l.juzN=jN;l.sg=nsg;l.ayahs=nsg.length*50;
  } else {
    const sN=parseInt(document.getElementById(sId).value);const s=SH[sN-1];
    const fr=parseInt(document.getElementById(fId).value);const to=parseInt(document.getElementById(tId).value);
    if(fr>to){ntf("From must be â‰¤ To",true);return null;}
    if(to>s.a){ntf(`Max ayah is ${s.a}`,true);return null;}
    const pm=mxA(ST.u,sN,rt);
    const nA=rt==="primary"?Math.max(0,to-Math.max(fr-1,pm)):to-fr+1;
    if(rt==="primary"&&nA===0){ntf("These ayahs already counted!",true);return null;}
    l.surahN=sN;l.fromAyah=fr;l.toAyah=to;l.ayahs=to-fr+1;l.newAyahs=nA;
  }
  return l;
}

async function subML(){const l=await bLog("mLB","mJS","mSC","mSS","mFr","mTo","mNt",ST.mt);if(!l)return;await fbAdd(l);cModal("logModal");ntf("âœ… Saved! Jazakallah ğŸŒ™");document.getElementById("mNt").value="";}
async function subQL(){const l=await bLog("qLB","qJS","qSC","qSS","qFr","qTo","qNt",ST.qt);if(!l)return;await fbAdd(l);ntf("âœ… Saved! ğŸŒ™");document.getElementById("qNt").value="";uQF();}

function rDB(){
  const me=ST.u;if(!me)return;
  const myA=uniqA(me);const p=Math.min(100,Math.round(myA/TOT*100));
  const tA=ST.lg.filter(l=>l.user===me&&l.date===td()&&(l.rt||"primary")==="primary").reduce((a,l)=>a+(l.ayahs||0),0);
  const sk=stk(me);
  document.getElementById("dA").textContent=myA.toLocaleString();
  document.getElementById("dP").textContent=p+"%";
  document.getElementById("dT").textContent=tA;
  document.getElementById("dS").textContent=sk;
  document.getElementById("dPL").textContent=`${myA.toLocaleString()} / ${TOT.toLocaleString()} ayahs`;
  document.getElementById("dPP").textContent=p+"%";
  document.getElementById("dPF").style.width=p+"%";
  const logged=ST.lg.some(l=>l.user===me&&l.date===td());
  document.getElementById("bnr").innerHTML=logged?"":`<div class="rb"><div style="font-size:22px;">ğŸŒ…</div><div style="flex:1;"><div style="font-size:13px;font-weight:600;">Have you read today?</div><div style="font-size:11px;color:var(--mt);">Keep your streak alive!</div></div><button class="btn bg1 bsm" onclick="oModal('logModal')">Log</button></div>`;
  const tm={};ST.lg.filter(l=>l.date===td()&&(l.rt||"primary")==="primary").forEach(l=>{tm[l.user]=(tm[l.user]||0)+(l.ayahs||0);});
  const sr=Object.entries(tm).sort((a,b)=>b[1]-a[1]);
  document.getElementById("dTp").innerHTML=sr.length?sr.slice(0,5).map(([u,a],i)=>`<div class="lr"><div class="lrk">${["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][i]||i+1}</div><div class="av" style="background:${aC(u)};color:#000;width:30px;height:30px;font-size:11px;">${ini(u)}</div><div class="li"><div class="ln">${u}</div></div><div class="lv">${a}</div></div>`).join(""):'<div class="empty"><div class="ei">ğŸ“–</div><div>No readings today yet</div></div>';
  document.getElementById("dRc").innerHTML=ST.lg.slice(0,10).map(l=>{const d=l.type==="juz"?`Juz ${l.juzN} â€” ${(l.sg||[]).length}q`:`${SH[l.surahN-1]?.name||"?"} ${l.fromAyah}â€“${l.toAyah}`;return`<div class="lgi"><div class="av" style="background:${aC(l.user)};color:#000;width:28px;height:28px;font-size:10px;flex-shrink:0;">${ini(l.user)}</div><div><div class="lgxt"><strong>${l.user}</strong> Â· ${d} <span class="badge ${l.rt==="secondary"?"bdb":"bdg"}">${l.rt||"primary"}</span></div><div class="lgm">${l.date}${l.note?" Â· "+l.note:""}</div></div></div>`;}).join("")||'<div class="empty"><div class="ei">ğŸ“–</div><div>No logs yet</div></div>';
}

function rLB(){
  function lb(cid,fn){const m={};ST.lg.filter(fn).forEach(l=>{m[l.user]=(m[l.user]||0)+(l.ayahs||0);});const sr=Object.entries(m).sort((a,b)=>b[1]-a[1]);const mx=sr[0]?.[1]||1;const el=document.getElementById(cid);if(!el)return;el.innerHTML=sr.length?sr.map(([u,a],i)=>`<div class="lr"><div class="lrk" style="color:${["#ffd700","#c0c0c0","#cd7f32"][i]||"var(--mt)"}">${["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][i]||i+1}</div><div class="av" style="background:${aC(u)};color:#000;width:30px;height:30px;font-size:11px;">${ini(u)}</div><div class="li"><div class="ln">${u}${u===ST.u?' <span class="badge bdg">You</span>':""}</div><div class="lb2"><div class="lf" style="width:${Math.round(a/mx*100)}%"></div></div></div><div class="lv">${a.toLocaleString()}</div></div>`).join(""):'<div class="empty"><div>No data yet</div></div>';}
  lb("lbA",l=>(l.rt||"primary")==="primary");
  lb("lbW",l=>(l.rt||"primary")==="primary"&&l.date>=wAgo());
  lb("lbT",l=>(l.rt||"primary")==="primary"&&l.date===td());
  const us=[...new Set(ST.lg.map(l=>l.user))];
  const cm=us.map(u=>({u,p:Math.min(100,Math.round(uniqA(u)/TOT*100))})).sort((a,b)=>b.p-a.p);
  document.getElementById("lbC").innerHTML=cm.map((d,i)=>`<div class="lr"><div class="lrk" style="color:${["#ffd700","#c0c0c0","#cd7f32"][i]||"var(--mt)"}">${["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][i]||i+1}</div><div class="av" style="background:${aC(d.u)};color:#000;width:30px;height:30px;font-size:11px;">${ini(d.u)}</div><div class="li"><div class="ln">${d.u}</div><div class="lb2"><div class="lf" style="width:${d.p}%;background:var(--grn);"></div></div></div><div class="lv" style="color:var(--grn);">${d.p}%</div></div>`).join("")||'<div class="empty"><div>No data</div></div>';
}

function rPg(){
  const me=ST.u;if(!me)return;
  const sg=rSeg(me,"primary");
  document.getElementById("jGrid").innerHTML=Array.from({length:30},(_,i)=>{const n=i+1;const juz=JS[n-1];const dn=juz.s.filter(s=>sg.has(s.id)).length;const p=Math.round(dn/4*100);return`<div class="jc ${p===100?"dn":p>0?"pt":""}"><div class="jn">${n}</div><div class="jp">${p}%</div></div>`;}).join("");
  const wd=SH.filter(s=>mxA(me,s.n,"primary")>0);
  document.getElementById("sProg").innerHTML=wd.length?wd.map(s=>{const mx=mxA(me,s.n,"primary");const p=Math.round(mx/s.a*100);return`<div class="pw2" style="margin-bottom:11px;"><div class="pr"><span><strong>${s.n}. ${s.name}</strong> <span style="font-family:'Scheherazade New',serif;font-size:14px;">${s.ar}</span></span><span class="badge ${p===100?"bdgn":"bdg"}">${mx}/${s.a} Â· ${p}%</span></div><div class="pb"><div class="pf ${p===100?"grn":""}" style="width:${p}%"></div></div></div>`;}).join(""):'<div class="empty"><div class="ei">ğŸ“š</div><div>No surah readings yet</div></div>';
  const sl=ST.lg.filter(l=>l.user===me&&l.rt==="secondary");
  document.getElementById("secL").innerHTML=sl.length?sl.slice(0,10).map(l=>{const d=l.type==="juz"?`Juz ${l.juzN} â€” ${(l.sg||[]).length} quarters`:`${SH[l.surahN-1]?.name} Ayah ${l.fromAyah}â€“${l.toAyah}`;return`<div class="lgi"><div style="width:8px;height:8px;border-radius:50%;background:var(--blue);margin-top:5px;flex-shrink:0;"></div><div><div class="lgxt">${d}</div><div class="lgm">${l.date}${l.note?" Â· "+l.note:""}</div></div></div>`;}).join(""):'<div style="font-size:13px;color:var(--mt);">No secondary readings yet</div>';
}

function rQR(){const ls=ST.u?ST.lg.filter(l=>l.user===ST.u).slice(0,10):[];document.getElementById("qRc").innerHTML=ls.length?ls.map(l=>{const d=l.type==="juz"?`Juz ${l.juzN} â€” ${(l.sg||[]).length} quarters (~${(l.sg||[]).length*50} ayahs)`:`${SH[l.surahN-1]?.name} Ayah ${l.fromAyah}â€“${l.toAyah} (${l.ayahs} ayahs)`;return`<div class="lgi"><div style="width:8px;height:8px;border-radius:50%;background:${l.rt==="secondary"?"var(--blue)":"var(--gold)"};margin-top:5px;flex-shrink:0;"></div><div><div class="lgxt">${d} <span class="badge ${l.rt==="secondary"?"bdb":"bdg"}">${l.rt||"primary"}</span></div><div class="lgm">${l.date}${l.note?" Â· "+l.note:""}</div></div></div>`;}).join(""):'<div class="empty"><div class="ei">ğŸ“–</div><div>No logs yet</div></div>';}

function tglRem(){const on=document.getElementById("remTgl").checked;document.getElementById("remTW").style.display=on?"":"none";if(on){rqNtf();schRem();}else{localStorage.removeItem("qt_rem");ntf("Reminder off");}}
async function rqNtf(){if(!("Notification" in window)){ntf("Not supported",true);return;}const p=await Notification.requestPermission();if(p!=="granted"){ntf("Allow notifications",true);document.getElementById("remTgl").checked=false;}else ntf("Notifications enabled âœ…");}
function savRT(){schRem();ntf("Reminder saved!");}
function schRem(){const t=document.getElementById("remTm").value||"05:30";localStorage.setItem("qt_rem",JSON.stringify({on:true,t}));clearInterval(window._rI);window._rI=setInterval(()=>{const s=JSON.parse(localStorage.getItem("qt_rem")||"{}");if(!s.on)return;const now=new Date();const[h,m]=s.t.split(":").map(Number);if(now.getHours()===h&&now.getMinutes()===m){const lg=ST.lg.some(l=>l.user===ST.u&&l.date===td());if(!lg&&Notification.permission==="granted"){new Notification("ğŸŒ… Quran Tracker",{body:`Assalamualaikum ${ST.u||""}! Time to log your Quran reading. ğŸ“–`,icon:"icon-192.png"});}}},60000);}
function ldRem(){const s=JSON.parse(localStorage.getItem("qt_rem")||"{}");if(s.on){document.getElementById("remTgl").checked=true;document.getElementById("remTW").style.display="";if(s.t)document.getElementById("remTm").value=s.t;schRem();}}

async function cfDel(){if(!ST.u){ntf("No user",true);return;}if(!confirm(`Delete ALL logs for ${ST.u}?`))return;await fbDel(ST.u);ntf("Logs deleted");}

function sTab(id){document.querySelectorAll(".tab").forEach((t,i)=>{const ids=["dashboard","log","progress","leaderboard","settings"];t.classList.toggle("active",ids[i]===id);});document.querySelectorAll(".pg").forEach(p=>p.classList.remove("active"));document.getElementById("pg-"+id).classList.add("active");if(id==="leaderboard")rLB();if(id==="progress")rPg();if(id==="log"){rQR();uQF();}}
function oModal(id){document.getElementById(id).classList.add("open");if(id==="userModal")rUM();if(id==="logModal")uMF();}
function cModal(id){document.getElementById(id).classList.remove("open");}
function ntf(msg,err=false){const n=document.getElementById("ntf");n.textContent=msg;n.className="ntf"+(err?" err":"");n.style.display="block";clearTimeout(window._nt);window._nt=setTimeout(()=>n.style.display="none",2800);}
function rAll(){uHdr();rUM();rDB();rQR();}

window.addEventListener("offline",()=>{document.getElementById("ofb").style.display="block";document.getElementById("sdot").className="sd";});
window.addEventListener("online",()=>{document.getElementById("ofb").style.display="none";document.getElementById("sdot").className="sd live";});

document.addEventListener("DOMContentLoaded",()=>{
  popSels();uHdr();ldRem();
  rSgs(1,"mSC","primary");rSgs(1,"qSC","primary");
  document.querySelectorAll(".mo").forEach(el=>{el.addEventListener("click",e=>{if(e.target===el)el.classList.remove("open");});});
  document.getElementById("nuInp").addEventListener("keydown",e=>{if(e.key==="Enter")addUser();});
  document.getElementById("mJS").addEventListener("change",rMSg);
  document.getElementById("qJS").addEventListener("change",rQSg);
  document.getElementById("mSS").addEventListener("change",uMS);
  document.getElementById("qSS").addEventListener("change",uQS);
  if(!ST.u)setTimeout(()=>oModal("userModal"),700);
});
if("serviceWorker" in navigator)navigator.serviceWorker.register("sw.js").catch(()=>{});
</script>
</body>
</html>